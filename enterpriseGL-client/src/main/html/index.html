<!DOCTYPE html>
<html>
    <head>
        <title>A simple use of EnterpriseGL-client javascript library</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>
    <body>
        <!--
        <script id="SIMPLE_VERTEX_SHADER" type="text/x-vertex" src="shaders/vertexShBase" ></script>
        <script id="SIMPLE_FRAGMENT_SHADER" type="text/x-fragment" src="shaders/fragmentShBase"></script>
        -->
        
<script id="PARTICLE_VERTEX_SHADER" type="x-shader/x-vertex">
#ifdef GL_ES
precision highp float;
#endif

uniform   mat4 u_mvp;
uniform   float timeShader;

attribute vec3 a_position;
attribute vec3 a_direction;
attribute vec3 a_velocity;
attribute vec3 a_acceleration;

varying   vec3 v_color;

void main(void)
{
    //Simulation  
    float life = a_acceleration.x-timeShader*0.25*a_acceleration.y;  
    life = life>0.0?life:0.0;

    //Color
	v_color    = (vec3(1.0,0.95,0.2)*life+(1.0-life)*vec3(1.0,0.2,0.1))*life;
	
	//Position Simulation
	vec3 dir = normalize(a_direction);
	vec3 vel = normalize(a_velocity);
	vec3 workPos = a_position+dir*(a_acceleration.z*timeShader*timeShader*0.5)+1.0*vel*timeShader;

	gl_Position = u_mvp * vec4(workPos, 1.0);
	gl_PointSize = min(1.0/(life+0.01),10.0) + 10.5;
}
</script>

<script id="PARTICLE_FRAGMENT_SHADER" type="x-shader/x-fragment">
#ifdef GL_ES
precision highp float;
#endif

varying vec3 v_color;

void main(void)
{
	gl_FragData[0] = vec4(v_color, 1.0);
}
</script>        

<script id="SIMPLE_VERTEX_SHADER" type="text/x-vertex">
#ifdef GL_ES
precision highp float;
#endif

uniform   mat4 u_mvp;

attribute vec3 a_position;
attribute vec3 a_color;

varying   vec3 v_color;

void main(void)
{
	v_color    = a_color;
	gl_Position = u_mvp * vec4(a_position, 1.0);
        gl_PointSize = 10.0;
}
</script>

<script id="SIMPLE_FRAGMENT_SHADER" type="text/x-fragment">
#ifdef GL_ES
precision highp float;
#endif

varying vec3 v_color;

void main(void)
{
	gl_FragData[0] = vec4(v_color, 1.0);
}
</script>

<script id="TEX_VERTEX_SHADER" type="text/x-vertex">
#ifdef GL_ES
precision highp float;
#endif

uniform   mat4 u_mvp;

attribute vec2 a_position;
attribute vec2 a_texcoord;

varying   vec2 v_texcoord;

void main(void)
{
	v_texcoord  = a_texcoord;
	gl_Position = u_mvp * vec4(a_position, 0.0, 1.0);
}
</script>

<script id="TEX_FRAGMENT_SHADER" type="text/x-fragment">
#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D s_texture;

varying vec2     v_texcoord;

void main(void)
{
	vec3 color = texture2D(s_texture, v_texcoord).xyz;
	gl_FragData[0] = vec4(color, 1);
}
</script>

        <script type="text/javascript" src="lib/jquery-1.4.4.min.js"></script>
        <script type="text/javascript" src="lib/glMatrix-0.9.5.min.js"></script>
        <script type="text/javascript" src="lib/spiderGL.js"></script>
        <script type="text/javascript" src="${project.build.finalName}.js"></script>
        <script type="text/javascript">
            /** 
             * Javascript code for enviroment configurations
             **/
            var enviroment = new EnvModel();
            enviroment.idVertexShader = "PARTICLE_VERTEX_SHADER";
            enviroment.idFragmentShader = "PARTICLE_FRAGMENT_SHADER";
            
            enviroment.idVertexShader = "SIMPLE_VERTEX_SHADER";
            enviroment.idFragmentShader = "SIMPLE_FRAGMENT_SHADER";
            enviroment.setup();

            function log(msg,elem,override){
                var idLog = "LOG";
                if(elem) idLog = elem;
                if(override) {
                    document.getElementById(idLog).
                        innerHTML = (msg + "\n");                    
                } else {
                    document.getElementById(idLog).
                        innerHTML += (msg + "\n");                    
                }
            }

        </script>
        
        <div>
            Session for visualitation of WebGL scene. <br/>
            
            <canvas id="SGL_CANVAS1" width="800" height="420"></canvas>
            
            <div>
                <span>Graphics data:</span><br/>
                <dir id="VIEWMATRIX">
                </dir>
                <dir id="ROTATION">
                    
                </dir>
                <dir id="DRAW"></dir>
            </div>
            <div>
                <span>Log Messages:</span><br/>
                <dir id="LOG">
                </dir>
            </div>
            
        </div>
    </body>
</html>
